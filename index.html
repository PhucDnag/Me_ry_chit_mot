<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Winter Magic Love</title>
  <meta name="theme-color" content="#0e2433" />
  
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

  <style>

    :root{
      --bg1:#0b1e2d; --bg2:#13354f; --glass:rgba(255,255,255,.12);
      --text:#e9f2f8; --muted:#cfe3f0; --accent:#ff6b6b; --gold:#ffd166;
      --forest:#0f5c27; --pine:#2d8a4e; /* M√†u c√¢y xanh */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--text); font-family:Poppins,system-ui,sans-serif;
      background: radial-gradient(ellipse at bottom, #1B2735 0%, #090A0F 100%);
      overflow-x:hidden;
      overflow-y:auto; 
    }
    #snow{ position:fixed; inset:0; z-index:99; pointer-events:none; }

    .screen {
        position: relative;
        width: 100%;
        min-height: 100vh;
        overflow-y: auto;
    }

    .screen.hidden {
      opacity: 0; visibility: hidden; pointer-events: none; position: fixed ;
    }

    /* --- TRANG 1: THI·ªÜP GI√ÅNG SINH --- */
    .wrap{
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      padding:40px 15px; gap:20px;
      min-height: 100vh;
    }
    
    .card{
      width:min(920px, 94vw);
      background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      border:1px solid rgba(255,255,255,.18);
      border-radius:20px; padding:20px;
      box-shadow:0 20px 50px rgba(0,0,0,.35);
      backdrop-filter: blur(10px);
      margin-bottom: 20px;
    }

    h1{
      font-family:"Great Vibes", cursive; 
      font-size: clamp(36px, 10vw, 76px);
      line-height:1.1; margin:0; 
      text-shadow: 0 6px 30px rgba(255,255,255,.2); 
      text-align: center;
    }
    h1 .spark{ color: var(--gold); }
    
    .subtitle{ 
        margin-top:8px; font-weight:300; color:var(--muted); text-align:center; 
        font-size: clamp(14px, 4vw, 20px); line-height: 1.5;
    }

    .countdown{ display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-top:20px; }
    .timebox{
      min-width:70px; padding:10px 8px; border-radius:12px; background: var(--glass);
      border:1px solid rgba(255,255,255,.15); text-align:center; flex: 1;
      max-width: 100px;
    }
    .timebox .num{ font-size: clamp(20px, 6vw, 40px); font-weight:600; }
    .timebox .lbl{ font-size:11px; opacity:.8; margin-top:4px; text-transform:uppercase}

    .actions{ display:flex; gap:10px; flex-wrap:wrap; justify-content:center; margin-top:20px; }
    .btn{
      border:1px solid rgba(255,255,255,.2); color:var(--text); background: rgba(255,255,255,.08);
      padding:12px 20px; border-radius:30px; cursor:pointer; font-weight:600; transition:.2s ease; font-family:inherit;
      font-size: 14px; flex-shrink: 0;
    }
    .btn:hover{ transform: translateY(-2px); background: rgba(255,255,255,.15); }
    .btn.primary{ background: linear-gradient(180deg, #ff7b7b, #ff4d6d); border:none; }
    .btn.tree-btn{ background: linear-gradient(180deg, #2d6a4f, #1b4332); border-color:#40916c; color:#d8f3dc; }

    /* Gallery Responsive Grid */
    .gallery{ display:grid; grid-template-columns: repeat(12, 1fr); gap:10px; margin-top:20px; }
    .photo{
      grid-column: span 4; border-radius:12px; overflow:hidden; aspect-ratio: 4/3;
      background: rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12);
    }
    .photo img{ width:100%; height:100%; object-fit:cover; }
    
    @media (max-width: 500px){ 
        .photo{ grid-column: span 12; }
        .actions { flex-direction: column; width: 100%; }
        .btn { width: 100%; }
        .wrap { padding-top: 20px; }
    }

    .sign{ margin-top:16px; text-align:center; color:var(--muted); font-size:13px; }

    /* =========================================
       TRANG 2: MAGIC TREE
       ========================================= */
    #treePage {
      background: #000; overflow: hidden; position: fixed;
    }
    
    .back-btn {
      position: absolute; top: 15px; left: 15px; z-index: 200;
      background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.2);
      color: #fff; padding: 8px 16px; border-radius: 30px; cursor: pointer;
      font-size: 13px; backdrop-filter: blur(5px);
    }

    #ui-controls {
        position: absolute; bottom: 30px; width: 100%;
        display: flex; justify-content: center; gap: 15px;
        z-index: 100; pointer-events: none;
        flex-wrap: wrap; padding: 0 20px;
    }
    @media (max-width: 600px) {
        #ui-controls { bottom: 60px; }
    }

    .control-btn {
        pointer-events: auto; cursor: pointer;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255,255,255,0.3);
        color: var(--text);
        padding: 10px 20px; border-radius: 30px;
        font-weight: 600; font-size: 14px; font-family: inherit;
        transition: all 0.3s ease;
        display: flex; align-items: center; gap: 6px; white-space: nowrap;
    }
    .control-btn.active {
        background: rgba(255, 255, 255, 0.25);
        border-color: var(--gold); color: #fff;
        box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
    }

    #canvas-container { width: 100%; height: 100vh; display: block; }

    /* Modal */
    .modal-backdrop{
      position:fixed; inset:0; background: rgba(0,0,0,.8); display:none;
      align-items:center; justify-content:center; z-index:999; padding:20px;
    }
    .modal-backdrop.show{ display:flex; }
    .modal{
      width:min(500px, 100%); background: #fff; color:#1a2a35;
      border-radius:16px; padding:25px; position:relative;
      max-height: 80vh; overflow-y: auto;
    }
    .modal h3{ font-family:"Great Vibes"; font-size:32px; color:#e63946; margin:0 0 10px; }
    .close{ position:absolute; top:10px; right:15px; background:none; border:none; font-size:24px; cursor:pointer; color: #333; }
  </style>
</head>
<body>
  <canvas id="snow" aria-hidden="true"></canvas>

  <main id="mainCard" class="screen wrap">
    <section class="card">
      <h1>Merry Christmas <span class="spark">‚ú¶</span></h1>
      <div class="subtitle">Anh bi·∫øt Noel n√†y em kh√¥ng ƒëi ch∆°i ƒë∆∞·ª£c, n√™n anh mang c·∫£ kh√¥ng kh√≠ Gi√°ng Sinh n√†y ƒë·∫øn v·ªõi em. üéÑ‚ú® ‚ùÑÔ∏è</div>

      <div class="countdown">
        <div class="timebox"><div class="num" id="dd">--</div><div class="lbl">Ng√†y</div></div>
        <div class="timebox"><div class="num" id="hh">--</div><div class="lbl">Gi·ªù</div></div>
        <div class="timebox"><div class="num" id="mm">--</div><div class="lbl">Ph√∫t</div></div>
        <div class="timebox"><div class="num" id="ss">--</div><div class="lbl">Gi√¢y</div></div>
      </div>

      <div class="actions">
        <button class="btn primary" id="btnLove">M·ªü l·ªùi ch√∫c üéÅ</button>
        <button class="btn tree-btn" id="btnToTree">C√¢y th√¥ng Noel ‚ú®</button> 
        <button class="btn" id="btnMusic">Ph√°t nh·∫°c ‚ô™</button>
      </div>

      <div class="gallery" id="gallery"></div>
      <div class="sign" id="signature"></div>
    </section>
  </main>

  <section id="treePage" class="screen hidden">
    <button class="back-btn" id="btnBack">‚¨Ö V·ªÅ thi·ªáp ch√≠nh</button>
    
    <div id="ui-controls">
        <button class="control-btn active" onclick="changeState('TREE', this)">üéÑ C√¢y Th√¥ng</button>
        <button class="control-btn" onclick="changeState('EXPLODE', this)">‚ú® Kho·∫£nh Kh·∫Øc</button>
    </div>

    <div id="canvas-container"></div>
  </section>

  <div class="modal-backdrop" id="backdrop">
    <div class="modal">
      <button class="close" id="closeModal">‚úï</button>
      <h3>G·ª≠i em,</h3>
      <p id="loveText"></p>
    </div>
  </div>
  <audio id="music" preload="none" loop></audio>

  <script>
    const CONFIG = {
      loveMessage: "Mong l√† nh·ªØng ƒëi·ªÅu nh·ªè b√© n√†y s·∫Ω mang ƒë·∫øn cho em ch√∫t kh√¥ng kh√≠ Gi√°ng Sinh ·∫•m √°p. Ch√∫c em m·ªôt m√πa Noel an l√†nh v√† th·∫≠t nhi·ªÅu ni·ªÅm vui üéÑ‚ú®",
      musicUrl: "music.mp3",

      galleryPhotos: [
        "https://images.unsplash.com/photo-1543589077-47d81606c1bf?q=80&w=800&auto=format&fit=crop",
        "https://images.unsplash.com/photo-1512389142860-9c449e58a543?q=80&w=800&auto=format&fit=crop",
        "https://mega.com.vn/media/news/0912_hinh-nen-noel-cho-dien-thoai-treo-ngoi-nha.jpg",
      ],

      treePhotos: [
         "one.jpg",
         "two.jpg",
         "three.jpg",
         "four.jpg",
          "five.jpg"
      ],

      colors: {
          forestGreen: 0x0f5c27,
          pineGreen: 0x2d8a4e,
          goldLight: 0xffd700
      }
    };

    // --- SETUP THI·ªÜP CH√çNH ---
    document.getElementById("signature").textContent = `‚Äî Ch√∫c em m·ªôt m√πa Noel th·∫≠t xinh ‚Äî`;
    document.getElementById("loveText").textContent = CONFIG.loveMessage;
    
    // S·ª≠ d·ª•ng galleryPhotos cho trang ch·ªß
    const galleryEl = document.getElementById("gallery");
    galleryEl.innerHTML = CONFIG.galleryPhotos.slice(0,3).map(src => `<figure class="photo"><img src="${src}"></figure>`).join("");
    
    const audio = document.getElementById("music");
    audio.src = CONFIG.musicUrl;
    const btnMusic = document.getElementById("btnMusic");
    let isPlaying = false;
    btnMusic.addEventListener("click", () => {
      if(!isPlaying){ audio.play().catch(e=>console.log("Auto-play blocked")); isPlaying=true; btnMusic.textContent="T·∫°m d·ª´ng ‚ô™"; }
      else { audio.pause(); isPlaying=false; btnMusic.textContent="Ph√°t nh·∫°c ‚ô™"; }
    });

    // --- CHUY·ªÇN TRANG ---
    const mainCard = document.getElementById("mainCard");
    const treePage = document.getElementById("treePage");
    let magicInitialized = false;

    document.getElementById("btnToTree").addEventListener("click", () => {
      mainCard.classList.add("hidden");
      treePage.classList.remove("hidden");
      if (!magicInitialized) { init3D(); magicInitialized = true; }
      if(!isPlaying) { 
          audio.play().then(() => { isPlaying = true; btnMusic.textContent="T·∫°m d·ª´ng ‚ô™"; })
          .catch(e => console.log("C·∫ßn click ƒë·ªÉ ph√°t nh·∫°c.")); 
      }
    });

    document.getElementById("btnBack").addEventListener("click", () => {
      treePage.classList.add("hidden");
      mainCard.classList.remove("hidden");
    });
    
    const loader = new THREE.TextureLoader();
    // S·ª≠ d·ª•ng treePhotos cho ph·∫ßn 3D
    const photoTextures = CONFIG.treePhotos.map(f => loader.load(f));

    function createSharpTexture(colorHex) {
        const canvas = document.createElement('canvas'); canvas.width = 64; canvas.height = 64;
        const ctx = canvas.getContext('2d'); const cx = 32, cy = 32;
        const grd = ctx.createRadialGradient(cx, cy, 0, cx, cy, 26);
        grd.addColorStop(0, 'rgba(255,255,255,1)'); 
        grd.addColorStop(0.2, colorHex); 
        grd.addColorStop(0.8, colorHex.replace('1)', '0.1)')); 
        grd.addColorStop(1, 'rgba(0,0,0,0)');
        ctx.fillStyle = grd; ctx.fillRect(0,0,64,64);
        return new THREE.CanvasTexture(canvas);
    }

    const textures = {
        forest: createSharpTexture('rgba(15, 92, 39, 1)'),
        pine: createSharpTexture('rgba(45, 138, 78, 1)'),
        gold: createSharpTexture('rgba(255, 215, 0, 1)')
    };

    let scene, camera, renderer;
    let groupForest, groupPine, groupGold; 
    let photoMeshes = [], titleMesh, starMesh;
    let state = 'TREE';

    function init3D() {
        const container = document.getElementById('canvas-container');
        scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x0a1520, 0.003); 

        camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
        
        updateCameraPosition();

        renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2)); 
        container.innerHTML = ""; container.appendChild(renderer.domElement);

        const ambientLight = new THREE.AmbientLight(0x506050, 0.6);
        scene.add(ambientLight);

        // T·∫°o h·∫°t
        const isMobile = window.innerWidth < 768;
        const particleCountMult = isMobile ? 0.7 : 1.0;

        groupForest = createParticleSystem('forest', CONFIG.colors.forestGreen, 2000 * particleCountMult, 2.2);
        groupPine = createParticleSystem('pine', CONFIG.colors.pineGreen, 800 * particleCountMult, 2.8); 
        groupGold = createParticleSystem('gold', CONFIG.colors.goldLight, 300 * particleCountMult, 3.5); 

        createPhotos();
        createDecorations();
        animate();
    }

    function updateCameraPosition() {
        if (!camera) return;
        const aspect = window.innerWidth / window.innerHeight;
        if (aspect < 0.7) { 
            camera.position.z = 160; // Mobile Portrait
        } else if (aspect < 1.0) {
            camera.position.z = 140; // Tablet Portrait
        } else {
            camera.position.z = 110; // Desktop Landscape
        }
    }

    function createParticleSystem(type, colorHex, count, size) {
        const pPositions = [], pExplodeTargets = [], pTreeTargets = [];
        const sizes = [], phases = []; 
        const treeHeight = 80, treeBaseRadius = 40;

        for(let i=0; i<count; i++) {
            const h = Math.random() * treeHeight; 
            const y = h - treeHeight / 2 + 5; 
            let radiusRatio;
            if (type === 'forest') radiusRatio = Math.pow(Math.random(), 0.6); 
            else if (type === 'pine') radiusRatio = 0.8 + Math.random() * 0.2; 
            else radiusRatio = Math.sqrt(Math.random()); 

            const maxR = (1 - (h / treeHeight)) * treeBaseRadius;
            const r = maxR * radiusRatio; 
            const theta = Math.random() * Math.PI * 2;
            pTreeTargets.push(r * Math.cos(theta), y, r * Math.sin(theta));

            const u = Math.random(), v = Math.random();
            const phi = Math.acos(2 * v - 1), lam = 2 * Math.PI * u;
            const rad = 75 * Math.cbrt(Math.random());
            pExplodeTargets.push(rad * Math.sin(phi) * Math.cos(lam), rad * Math.sin(phi) * Math.sin(lam), rad * Math.cos(phi));

            pPositions.push(pTreeTargets[i*3], pTreeTargets[i*3+1], pTreeTargets[i*3+2]);
            sizes.push(size * (0.85 + Math.random()*0.3)); 
            phases.push(Math.random() * Math.PI * 2);
        }

        const geo = new THREE.BufferGeometry();
        geo.setAttribute('position', new THREE.Float32BufferAttribute(pPositions, 3));
        geo.setAttribute('size', new THREE.Float32BufferAttribute(sizes, 1));
        const colors = new Float32Array(count * 3); const baseColor = new THREE.Color(colorHex);
        for(let i=0; i<count; i++) { colors[i*3]=baseColor.r; colors[i*3+1]=baseColor.g; colors[i*3+2]=baseColor.b; }
        geo.setAttribute('color', new THREE.BufferAttribute(colors, 3));
        
        geo.userData = { tree: pTreeTargets, explode: pExplodeTargets, phases: phases, baseColor: baseColor, baseSize: size };

        const mat = new THREE.PointsMaterial({
            size: size, map: textures[type], transparent: true, 
            opacity: 0.95, vertexColors: true, blending: THREE.AdditiveBlending, 
            depthWrite: false, sizeAttenuation: true
        });
        const points = new THREE.Points(geo, mat);
        scene.add(points);
        return points;
    }

    function createPhotos() {
        const geo = new THREE.PlaneGeometry(12, 12);
        const borderGeo = new THREE.PlaneGeometry(12.5, 12.5); 
        const borderMat = new THREE.MeshBasicMaterial({ color: CONFIG.colors.goldLight }); 
        
        for(let i=0; i<5; i++) {
            const tex = photoTextures[i % photoTextures.length];
            const mat = new THREE.MeshBasicMaterial({ map: tex, side: THREE.DoubleSide });
            const mesh = new THREE.Mesh(geo, mat);
            const border = new THREE.Mesh(borderGeo, borderMat); border.position.z = -0.05; mesh.add(border);
            mesh.visible = false; mesh.scale.set(0,0,0);
            scene.add(mesh);
            photoMeshes.push(mesh);
        }
    }

    function createDecorations() {
        const canvas = document.createElement('canvas'); canvas.width = 1024; canvas.height = 256;
        const ctx = canvas.getContext('2d'); ctx.font = 'bold italic 90px "Great Vibes"';
        ctx.fillStyle = '#fffdd0'; ctx.textAlign = 'center'; ctx.shadowColor = "#ffd700"; ctx.shadowBlur = 35; 
        ctx.fillText("Merry Christmas", 512, 130);
        const tex = new THREE.CanvasTexture(canvas);
        const mat = new THREE.MeshBasicMaterial({ map: tex, transparent: true, blending: THREE.AdditiveBlending, opacity: 1.0 });
        titleMesh = new THREE.Mesh(new THREE.PlaneGeometry(70, 18), mat);
        titleMesh.position.set(0, 55, 0);
        scene.add(titleMesh);

        const starCanvas = document.createElement('canvas'); starCanvas.width = 128; starCanvas.height = 128;
        const sCtx = starCanvas.getContext('2d'); sCtx.fillStyle = "#ffd700"; sCtx.shadowColor="#ffec8b"; sCtx.shadowBlur=35;
        sCtx.beginPath(); const cx=64, cy=64, outer=50, inner=20;
        for(let i=0; i<5; i++){ sCtx.lineTo(cx + Math.cos((18+i*72)/180*Math.PI)*outer, cy - Math.sin((18+i*72)/180*Math.PI)*outer); sCtx.lineTo(cx + Math.cos((54+i*72)/180*Math.PI)*inner, cy - Math.sin((54+i*72)/180*Math.PI)*inner); }
        sCtx.closePath(); sCtx.fill();
        const starMat = new THREE.MeshBasicMaterial({ map: new THREE.CanvasTexture(starCanvas), transparent: true, blending: THREE.AdditiveBlending });
        starMesh = new THREE.Mesh(new THREE.PlaneGeometry(16, 16), starMat);
        starMesh.position.set(0, 45, 0);
        scene.add(starMesh);
    }

    function updateParticleGroup(group, targetState, speed, time) {
        const positions = group.geometry.attributes.position.array;
        const sizes = group.geometry.attributes.size.array;
        const colors = group.geometry.attributes.color.array;
        const { phases, baseColor, baseSize } = group.geometry.userData;
        const targets = group.geometry.userData[targetState === 'EXPLODE' ? 'explode' : 'tree'];

        for(let i=0; i<positions.length; i++) positions[i] += (targets[i] - positions[i]) * speed;
        group.geometry.attributes.position.needsUpdate = true;
        
        const count = positions.length / 3;
        if (targetState === 'TREE') {
            group.rotation.y += 0.0025; 
            for(let i=0; i<count; i++) {
                let brightness = 0.8 + 0.25 * Math.sin(time * 2.5 + phases[i]);
                colors[i*3] = baseColor.r * brightness; colors[i*3+1] = baseColor.g * brightness; colors[i*3+2] = baseColor.b * brightness;
                sizes[i] = baseSize * (0.95 + 0.1 * Math.sin(time * 3 + phases[i]));
            }
        } else { 
            group.scale.set(1,1,1); group.rotation.y += 0.001; 
            for(let i=0; i<count; i++) {
                let brightness = 0.9 + 0.1 * Math.cos(time + phases[i]);
                colors[i*3] = baseColor.r * brightness; colors[i*3+1] = baseColor.g * brightness; colors[i*3+2] = baseColor.b * brightness;
                sizes[i] = baseSize;
            }
        }
        group.geometry.attributes.color.needsUpdate = true; group.geometry.attributes.size.needsUpdate = true;
    }

    function animate() {
        requestAnimationFrame(animate);
        if (mainCard.classList.contains("hidden") === false) return; 
        const time = Date.now() * 0.001;
        const speed = 0.06; 

        updateParticleGroup(groupForest, state, speed, time);
        updateParticleGroup(groupPine, state, speed, time);
        updateParticleGroup(groupGold, state, speed, time);

        titleMesh.visible = starMesh.visible = (state === 'TREE');

        if (state === 'TREE') {
            starMesh.rotation.z -= 0.015; 
            starMesh.material.opacity = 0.85 + 0.15*Math.sin(time*4);
            photoMeshes.forEach(m => { m.scale.lerp(new THREE.Vector3(0,0,0), 0.1); m.visible = false; });
        } else if (state === 'EXPLODE') {
            const angleStep = (Math.PI * 2) / photoMeshes.length;
            photoMeshes.forEach((mesh, i) => {
                mesh.visible = true;
                const angle = time * 0.4 + i * angleStep; 
                const radius = 38;
                mesh.position.lerp(new THREE.Vector3(Math.sin(angle)*radius, Math.sin(time*1.2+i)*6, Math.cos(angle)*radius), 0.06);
                mesh.lookAt(camera.position);
                const targetScale = mesh.position.z > 12 ? 1.8 : 0.8;
                mesh.scale.lerp(new THREE.Vector3(targetScale, targetScale, targetScale), 0.1);
            });
        }
        renderer.render(scene, camera);
    }

    function changeState(newState, btnElement) {
        state = newState;
        document.querySelectorAll('.control-btn').forEach(btn => btn.classList.remove('active'));
        if(btnElement) btnElement.classList.add('active');
    }

    window.addEventListener('resize', () => {
        if(camera) { 
            camera.aspect = window.innerWidth/window.innerHeight; 
            camera.updateProjectionMatrix(); 
            renderer.setSize(window.innerWidth, window.innerHeight);
            updateCameraPosition(); 
        }
        initSnow();
    });

    // Snow & CountDown & Modal
    const snowCanvas = document.getElementById("snow"), snowCtx = snowCanvas.getContext("2d");
    let W, H, flakes=[];
    function initSnow(){ W = snowCanvas.width = window.innerWidth; H = snowCanvas.height = window.innerHeight; flakes = Array.from({length: 150}, () => ({ x:Math.random()*W, y:Math.random()*H, r:Math.random()*2+1, s:Math.random()*1+0.5 })); }
    initSnow();
    function drawSnow(){ snowCtx.clearRect(0,0,W,H); snowCtx.fillStyle="rgba(255,255,255,0.7)"; snowCtx.beginPath(); flakes.forEach(f => { snowCtx.moveTo(f.x, f.y); snowCtx.arc(f.x, f.y, f.r, 0, Math.PI*2); f.y += f.s; f.x += Math.sin(f.y/50)*0.5; if(f.y>H) f.y=-10; if(f.x>W) f.x=0; if(f.x<0) f.x=W; }); snowCtx.fill(); requestAnimationFrame(drawSnow); }
    drawSnow();
    const dd=document.getElementById("dd"), hh=document.getElementById("hh"), mm=document.getElementById("mm"), ss=document.getElementById("ss");
    function updateCount(){ const now = new Date(); let target = new Date(now.getFullYear(), 11, 25); if(now > target) target = new Date(now.getFullYear()+1, 11, 25); const diff = (target - now)/1000; if(diff < 0) return; dd.textContent = Math.floor(diff/86400).toString().padStart(2,"0"); hh.textContent = Math.floor((diff%86400)/3600).toString().padStart(2,"0"); mm.textContent = Math.floor((diff%3600)/60).toString().padStart(2,"0"); ss.textContent = Math.floor(diff%60).toString().padStart(2,"0"); }
    setInterval(updateCount, 1000); updateCount();
    const backdrop = document.getElementById("backdrop");
    document.getElementById("btnLove").addEventListener("click", ()=> backdrop.classList.add("show"));
    document.getElementById("closeModal").addEventListener("click", ()=> backdrop.classList.remove("show"));
    backdrop.addEventListener("click", (e)=>{ if(e.target===backdrop) backdrop.classList.remove("show"); });
  </script>
</body>
</html>